#!/usr/bin/env python

import sys
sys.path.insert(0, '.')
import re
import argparse
import keyring
import getpass
import epc_cli

parser = argparse.ArgumentParser()
parser.add_argument("-c", "--config", 
                    type=str, 
                    default="config.json",
                    help="path to configuration file")

args = parser.parse_args()
config_data = epc_cli.load_config(args.config)
user_name = config_data['credentials']['username']
keyring_pwd_identifier = config_data['credentials']['password']
keyring_clientid_identifier = config_data['credentials']['client_id']
keyring_secret_identifier = config_data['credentials']['client_secret']

print(f'Configuring credentials for user {user_name}')

pwd_input = getpass.getpass("Enter password for {user_name}: ")
keyring.set_password(keyring_pwd_identifier, user_name, pwd_input)
print(f'Successfully updated password')
print()

clientid_input = getpass.getpass("Enter client_id for {user_name}: ")
keyring.set_password(keyring_clientid_identifier, user_name, clientid_input)
print(f'Successfully updated client_id')
print()

secret_input = getpass.getpass("Enter client_secret for {user_name}: ")
keyring.set_password(keyring_secret_identifier, user_name, secret_input)
print(f'Successfully updated client_secret')
print(f'Configuration of credentials for user {user_name} complete')
print(f'You can now use the application')





